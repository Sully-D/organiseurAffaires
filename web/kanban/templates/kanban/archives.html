{% extends 'kanban/base.html' %}

{% block content %}
<div class="board-header">
    <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem; color: #94a3b8;">
        <i class="fa-solid fa-box-archive"></i> Archives
    </h2>
</div>

<div class="board-container" style="display: block; overflow-y: auto; padding: 1rem;">
    {% if activities %}
    <div class="grid-view"
        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
        {% for activity in activities %}
        <div class="activity-card" data-id="{{ activity.id }}">
            <div class="card-header">
                <span class="date"><i class="fa-regular fa-calendar"></i> {{ activity.date|date:"d/m/Y" }}</span>
                {% if activity.tags.all %}
                <div class="tags">
                    {% for tag in activity.tags.all %}
                    <span class="tag" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <h3 class="card-title">{{ activity.name }}</h3>
            <div class="card-description">
                {{ activity.description|truncatechars:100 }}
            </div>
            <div class="card-actions" style="margin-top: 1rem; display: flex; justify-content: flex-end;">
                <button class="btn-icon" onclick="unarchiveActivity({{ activity.id }})" title="Restaurer"
                    style="color: #4ade80;">
                    <i class="fa-solid fa-rotate-left"></i> Restaurer
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; color: #64748b; margin-top: 3rem;">
        <i class="fa-solid fa-box-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <p>Aucune activité archivée.</p>
    </div>
    {% endif %}
</div>

<script>
    function unarchiveActivity(id) {
        if (!confirm('Restaurer cette activité vers "En attente" ?')) return;

        const csrftoken = getCookie('csrftoken');
        fetch(`/api/activity/${id}/unarchive/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            }
        }).then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                } else {
                    alert('Erreur: ' + data.message);
                }
            });
    }

    // CSRF Token Helper (same as in board.html)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock %}