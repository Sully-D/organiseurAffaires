<div class="activity-card {% if not hide_urgency %}{{ activity.urgency_class }}{% endif %}" data-id="{{ activity.id }}"
    data-name="{{ activity.name }}" data-date="{{ activity.date|date:'Y-m-d' }}"
    data-pending-traitements="{{ activity.pending_traitements }}" data-pending-taches="{{ activity.pending_taches }}"
    data-pending-traitement-names="{% for s in activity.scelles.all %}{% for t in s.traitements.all %}{% if not t.done %}{{ t.description|escape }}__SEP__{% endif %}{% endfor %}{% endfor %}"
    data-pending-tache-names="{% for s in activity.scelles.all %}{% for t in s.taches.all %}{% if not t.done %}{{ t.description|escape }}__SEP__{% endif %}{% endfor %}{% endfor %}">
    <div class="card-header">
        <span class="date"><i class="fa-regular fa-calendar"></i> {{ activity.date|date:"d/m/Y" }}</span>
        {% if activity.tags.all or activity.has_cta > 0 or activity.has_reparations > 0 %}
        <div class="tags">
            {% if activity.has_cta > 0 %}
            <span class="tag" style="background-color: #ef4444; color: white;">CTA</span>
            {% endif %}
            {% if activity.has_reparations > 0 %}
            <span class="tag" style="background-color: #f59e0b; color: white;">Rép.</span>
            {% endif %}
            {% for tag in activity.tags.all %}
            <span class="tag" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <h3 class="card-title">{{ activity.name }}</h3>
    <div class="card-description">
        {{ activity.description|truncatechars:100 }}
    </div>
    <div class="card-stats">
        {% with scelles_count=activity.scelles.count %}
        {% if scelles_count > 0 %}
        <span class="stat" title="Scellés"><i class="fa-solid fa-box"></i> {{ scelles_count }}</span>
        {% endif %}
        {% endwith %}

        {% if activity.pending_traitements > 0 %}
        <span class="stat" title="Traitements restants"><i class="fa-solid fa-clipboard-check"></i> {{ activity.pending_traitements }}</span>
        {% endif %}
        {% if activity.pending_taches > 0 %}
        <span class="stat" title="Tâches restantes"><i class="fa-solid fa-list-check"></i> {{ activity.pending_taches }}</span>
        {% endif %}
    </div>
    <div class="card-actions" style="margin-top: 1rem; display: flex; justify-content: flex-end; gap: 0.5rem;">
        {% if user.is_superuser %}
        <button class="delete-activity-btn" onclick="deleteActivity(event, {{ activity.id }})">
            <i class="fa-solid fa-trash"></i>
        </button>
        {% endif %}
    </div>
    <div class="done-checkbox-wrapper" onclick="event.stopPropagation()">
        <input type="checkbox" class="done-checkbox" autocomplete="off"
            onchange="toggleDone(event, {{ activity.id }}, this)" 
            {% if activity.column.name == 'Terminé' %}checked{% endif %} 
            {% if not user.is_superuser %}disabled{% endif %}>
    </div>
</div>
